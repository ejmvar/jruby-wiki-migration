{"href":"https://kenai.com/api/projects/jruby/features/wiki/pages/Mentawai/revisions/1.json","name":"Mentawai","number":1,"page_href":"https://kenai.com/api/projects/jruby/features/wiki/pages/Mentawai.json","person":"john_brock","description":"","text":"Mentawai (http://www.mentaframework.org/?loc=en) now fully supports JRuby. You are now able to write your actions in Ruby (or your whole application) or you can call any Ruby code from your Mentawai Java code.\r\n\r\n\r\nTo support plain Ruby, all you need to do is copy the jruby.jar file inside the /WEB-INF/lib directory of your Mentawai web application. However, if you plan to use RubyGems and the Ruby Libraries (like 'date' for example) you will need to install JRuby in the machine running your Tomcat web server. To install JRuby is very easy. Follow the steps below:\r\n\r\n* Download the zip file with the JRuby installation from here: http://dist.codehaus.org/jruby/ (Ex: jruby-bin-1.1.1.zip)\r\n\r\n* Extract everything inside your root directory (or any directory)\r\n\r\n* Set the environment variable JRUBY_HOME. (Ex: JRUBY_HOME=c:\\jruby-1.1.1)\r\n\r\n* Set the environment variable JRUBY_OPTS to -rubygems so that you don't need to require 'rubygems' in your code.\r\n\r\n* Change your PATH environment variable to include %JRUBY_HOME%\\bin so that you can call the jruby script from anywhere in your shell.\r\n\r\n\r\nIf you did the above steps correctly, you should be able to play with jruby in your shell. Check the examples below: \r\n\r\n c:\\>jruby -v\r\n ruby 1.8.6 (2008-04-22 rev 6555) [x86-jruby1.1.1]\r\n\r\n c:\\>jruby -S gem -v\r\n 1.1.0\r\n<pre>\r\n c:\\>jruby -S gem list --local\r\n\r\n *** LOCAL GEMS ***\r\n\r\n hoe (1.5.1)\r\n hpricot (0.6)\r\n jruby-openssl (0.2.3)\r\n mechanize (0.7.6)\r\n rake (0.8.1)\r\n rspec (1.1.3)\r\n rubyforge (0.4.5)\r\n sources (0.0.1)\r\n</pre>\r\n\r\n\r\nNow let's check an example of how to run Ruby inside your Mentawai web application. (download Mentawai 1.13 if you need from here: http://www.mentaframework.org/beta/mentawai.jar)\r\n\r\n\r\nAll your ruby code must be placed inside the /WEB-INF/ruby/ directory of your web application. Mentawai loads (<i>requires</i>) any Ruby file from this directory plus it will reload any modified file pretty much like a JSP.\r\n\r\n\r\nAn action written in Ruby: /WEB-INF/ruby/action_test.rb\r\n<pre>\r\n  include_class 'org.mentawai.core.BaseAction'\r\n\r\n  class MyFirstRubyAction < BaseAction\r\n  \r\n    def execute\r\n      output[\"msg\"] = \"Hello from JRuby !!!!\"\r\n      :success\r\n    end\r\n  \r\n  end\r\n</pre>\r\n\r\n\r\nA Java Action calling Ruby code: /WEB-INF/src/org/hello/action/Hello.java \r\n\r\n<pre>\r\npackage org.hello.action;\r\n\r\nimport java.util.Iterator;\r\nimport java.util.Map;\r\n\r\nimport org.mentawai.core.BaseAction;\r\nimport org.mentawai.jruby.JRubyInterpreter;\r\n\r\npublic class Hello extends BaseAction {\r\n\t\r\n\tJRubyInterpreter ruby = JRubyInterpreter.getInstance();\r\n\t\r\n\tpublic String execute() {\r\n\t\t\r\n\t\tObject users = ruby.eval(\"u = Users.new\");\r\n\t\t\r\n\t\tMap map = (Map) ruby.eval(\"u.get_users\");\r\n\t\t\r\n\t\tIterator iter = map.keySet().iterator();\r\n\t\t\r\n\t\tStringBuilder sb = new StringBuilder();\r\n\t\t\r\n\t\twhile(iter.hasNext()) {\r\n\t\t\tsb.append(iter.next()).append(\" \");\r\n\t\t}\r\n\t\t\r\n\t\toutput.setValue(\"msg\", \"Hello my friends: \" + sb.toString());\r\n\t\t\r\n\t\treturn SUCCESS;\r\n\t}\r\n}\r\n</pre>\r\n\r\n\r\nRuby code which is called by the Java action above: /WEB-INF/ruby/users_test.rb \r\n\r\n<pre>\r\n\r\nclass Users\r\n  \r\n  def get_users\r\n    a = {}\r\n    a['Sergio'] = 1\r\n    a['Robert'] = 2\r\n    a\r\n  end\r\n  \r\nend\r\n</pre>\r\n\r\n\r\nApplicationManager:\r\n\r\n<pre>\r\npackage org.hello;\r\n\r\nimport org.hello.action.Hello;\r\n\r\npublic class ApplicationManager extends org.mentawai.core.ApplicationManager {\r\n\t\r\n\t@Override\r\n\tpublic void loadActions() {\r\n\t\t\r\n\t\taction(\"/HelloRuby1\", Hello.class).on(SUCCESS, \"/hello.jsp\");\r\n\t\t\r\n\t\truby(\"/HelloRuby2\", \"MyFirstRubyAction\").on(SUCCESS, \"/hello.jsp\");\r\n\t\t\r\n\t}\r\n\t\r\n}\r\n</pre>\r\n\r\nSource: http://recipes.mentaframework.org/posts/list/57.page\r\n","created_at":"2008-08-12T19:47:23Z","content_type":"application/vnd.com.kenai.page.revision+json"}