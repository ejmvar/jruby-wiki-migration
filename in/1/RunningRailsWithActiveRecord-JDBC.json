{"href":"https://kenai.com/api/projects/jruby/features/wiki/pages/RunningRailsWithActiveRecord-JDBC/revisions/1.json","name":"RunningRailsWithActiveRecord-JDBC","number":1,"page_href":"https://kenai.com/api/projects/jruby/features/wiki/pages/RunningRailsWithActiveRecord-JDBC.json","person":"john_brock","description":"","text":"==ActiveRecord-JDBC Database Support==\r\n\r\nActiveRecord-JDBC 0.8.1 supports normal AR operations and basic migrations for the following databases:\r\n\r\n* SQLite3\r\n* MySQL\r\n* PostgreSQL\r\n* Oracle\r\n* HSQLDB (except migrations and habtm at least. I gave up)\r\n* H2\r\n* Microsoft SQL Server (except for change_column_default)\r\n* DB2 (except change_column, change_column_default, rename_column, remove_column, add_index, remove_index and rename_table)\r\n* Derby (except change_column, change_column_default, remove_column, rename_column)\r\n* FireBird (except change_column_default and rename_column)\r\n\r\nSee [http://jruby-extras.rubyforge.org/activerecord-jdbc-adapter the documentation] for more information.\r\n\r\n==Usage==\r\n\r\nHere's a walkthrough for MySQL in ultra-condensed form:\r\n\r\n1. Grab a JRuby release: [[Main_Page#Downloads]] and unpack it\r\n\r\n2. Set up path for JRuby\r\n\r\n      export PATH=$PATH:[jruby-dir]/bin\r\n\r\n3. Install Rails\r\n\r\n      jruby -S gem install rails\r\n\r\n4. Install ActiveRecord-JDBC for MySQL (see [http://jruby-extras.rubyforge.org/activerecord-jdbc-adapter the documentation] for other options). This will also install the dependent gem: '''activerecord-jdbc-adapter'''.\r\n\r\n      jruby -S gem install activerecord-jdbcmysql-adapter\r\n\r\nYou should see something like the following:\r\n\r\n    Successfully installed activerecord-jdbc-adapter-0.7.1\r\n    Successfully installed activerecord-jdbcmysql-adapter-0.7.1\r\n\r\nIf the RubyForge gem repositories do not yet have v0.7.1 or later of these gems you can try installing it from here:\r\n\r\n     jruby -S gem install activerecord-jdbcmysql-adapter --source http://caldersphere.net\r\n\r\n5. Generate a Rails App\r\n\r\n      rails ~/testapp --database mysql\r\n\r\n6 . Go to the app\r\n\r\n      cd ~/testapp\r\n\r\n7. If you're using Rails 2.0 modify database.yml by prepending \"jdbc\" to the adapter name. For PostgreSQL, you'll need to add the \"host\" parameter as well. If you're NOT using Rails 2.0, don't modify your database.yml file.\r\n\r\n      #SQLite3\r\n      development:\r\n        adapter: jdbcsqlite3\r\n        url: jdbc:sqlite:test.db # path to sqlite3 dbfile\r\n\r\n      #MYSQL\r\n      development:\r\n        adapter: jdbcmysql\r\n        encoding: utf8\r\n        database: testapp_development\r\n        username: root\r\n        password:\r\n\r\n      #POSTGRES\r\n      development:\r\n        adapter: jdbcpostgresql\r\n        encoding: unicode\r\n        host: localhost\r\n        database: testapp_development\r\n        username: testapp\r\n        password:\r\n\r\n      #ORACLE\r\n      development:\r\n        adapter: jdbc\r\n        driver: oracle.jdbc.OracleDriver\r\n        url: jdbc:oracle:thin:@myOracleHost:1521:mySID\r\n        username: myUser\r\n        password: myPass\r\n        \r\n\r\n8. If you're using Rails 2.0, you're done. The rest of configuration (including JDBC driver jar) is done automatically.  If you're running Rails 1.2.x, you'll need to modify environment.rb. Add the following snippet just above the Rails::Initializer line:\r\n\r\n      if RUBY_PLATFORM =~ /java/\r\n        require 'rubygems'\r\n        gem 'activerecord-jdbcmysql-adapter'\r\n        #require 'active_record/connection_adapters/jdbcmysql_adapter'\r\n        require 'jdbc_adapter' # Changed to comply with this [http://wiki.jruby.org/wiki/FAQs#I_get_the_error_.27undefined_method_.60cattr_accessor.27_for_ActiveRecord::Base:Class_.28NoMethodError.29.27_after_configuring_activerecord-jdbc.__What_is_wrong.3F FAQ] question.\r\n      end\r\n\r\n9. Create a testapp_development database, grants for testapp user, and widgets table in MySQL (use migrations if you like)\r\n\r\n10. Scaffold Widgets CRUD\r\n\r\n      jruby script/generate scaffold widget\r\n\r\n11. Start up the server\r\n\r\n      jruby script/server\r\n\r\n12. In your browser, go to http://localhost:3000/widget\r\n\r\nAnd that's about it. You've got a scaffolded widget page running in JRuby over JDBC to MySQL.\r\n\r\n==Troubleshooting==\r\n\r\n* ActiveRecord-JDBC does not install: I had some trouble myself; I think something's up with either RubyForge or with our released gem. You can always download ActiveRecord-JDBC and install it locally, of course.\r\n* scaffold fails with an error about \"nonexistent jdbc adapter\": Ensure you've added the require line to environment.rb (hopefully this will be unnecessary in the future)\r\n* scaffold and script/server terminate without running: Make sure you've successfully installed the ActiveRecord-JDBC gem. The additional require in environment.rb causes Rails scripts to die silently if there are any errors.\r\n* scaffold fails with the error \"cannot convert NilClass into String\": Make sure you've correctly specified the driver and url lines in database.yml\r\n* \"unable to choose type from ... for decimal\": postgresql and oracle don't report a type for decimal. Fixed in ActiveRecord-JDBC trunk.\r\n* If you are using Microsoft SQL Server and your migration do not work or you data is all String instead of the proper type, check this issue [http://jira.codehaus.org/browse/JRUBY-1352 JRUBY-1352] for a workaround.\r\n* if you see this error when trying to run a migration:\r\n  rake aborted!\r\n  undefined method `last' for {}:Hash\r\nit probably means you had previously used the 0.7.0 version of the activerecord-jdbcmysql-adapter and it had created the following rake task file in your rails application:\r\n  lib/tasks/jdbc_databases.rake\r\n* net/ssh doesn't work at this time with jruby 1.0.3 and net/ssh 1.1.2\r\nDelete this file and the error should go away. See: [http://jira.codehaus.org/browse/JRUBY-1859/ JRUBY-1859] for more info.\r\n* See [[Troubleshooting#JNI gotchas]] if you see this error when using SQL Server:\r\n com.microsoft.sqlserver.jdbc.AuthenticationJNI\r\n &lt;clinit&gt;\r\n WARNING: Failed to load the sqljdbc_auth.dll\r\n* You have foxy_fixtures plugin installed and you get the following error: \r\n<code>'load_missing_constant': uninitialized constant ActiveRecord::ConnectionAdapters::MysqlAdapter (NameError)</code>. \r\n\r\nThis error occurs because foxy_features ships with built-in active_record adatpers for mysql, sqlite and postgresql. Specifying any of the jdbc&lt;dbname&gt; or just jdbc will cause foxy_fixtures to load the MySQL ruby driver by default. This, obviously, will fail since there is no native MySQL driver for JRuby. To be able to run the app, the easy fix is to take the plugin out (uninstall). Development and testing with foxy_fixtures and activerecord-jdbc still needs to be researched.\r\n","created_at":"2008-08-12T19:56:41Z","content_type":"application/vnd.com.kenai.page.revision+json"}