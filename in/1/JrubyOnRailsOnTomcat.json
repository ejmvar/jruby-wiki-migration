{"href":"https://kenai.com/api/projects/jruby/features/wiki/pages/JrubyOnRailsOnTomcat/revisions/1.json","name":"JrubyOnRailsOnTomcat","number":1,"page_href":"https://kenai.com/api/projects/jruby/features/wiki/pages/JrubyOnRailsOnTomcat.json","person":"john_brock","description":"","text":"__TOC__\r\n\r\n== Rails 1.1 ==\r\n\r\n=== Prerequisites ===\r\n* Ruby on Rails 1.1\r\n* Java 5\r\n* Subversion\r\n* Tomcat 5.5\r\n* JRuby 1.0.2\r\n\r\n=== Environment setup ===\r\n* Create a rails app the normal way\r\n\r\n<pre>\r\nrails my-project\r\ncd my-project\r\n</pre>\r\n\r\n* Install ActiveRecord-JDBC\r\n\r\n    $JRUBY_HOME/bin/gem install activerecord-jdbc-adapter -y\r\n\r\n\r\n* Install Goldspike\r\n\r\n    jruby script/plugin install svn://rubyforge.org/var/svn/jruby-extras/trunk/rails-integration/plugins/goldspike\r\n\r\n\r\n* modify <code>database.yml</code>\r\n<pre>\r\ndevelopment:\r\n  adapter: jdbc\r\n  driver: com.mysql.jdbc.Driver\r\n  url: jdbc:mysql://localhost/blabla_development\r\n  username: root\r\n  password: root\r\n\r\n</pre>\r\n* Modify <code>environment.rb</code>\r\n<pre>\r\nrequire File.join(File.dirname(__FILE__), 'boot')\r\n\r\nif RUBY_PLATFORM =~ /java/\r\n   require 'rubygems'\r\n   RAILS_CONNECTION_ADAPTERS = %w(jdbc)\r\nend\r\n\r\nRails::Initializer.run do |config|\r\n\r\n</pre>\r\n\r\n=== Developing ===\r\n* Run generator\r\n\r\n    jruby script/generate goldspike\r\n\r\nthis will set up the <code>WEB-INF</code> dir and generate a web.xml\r\n\r\n* Copy jars to <code>WEB-INF/lib</code> in rails project dir\r\n\r\n* Build an app\r\n\r\n* Run migrations like this\r\n<pre>\r\njruby -S rake db:migrate\r\njruby -S rake db:migrate RAILS_ENV=production\r\n\r\n</pre>\r\n* Run a testing server like this\r\n\r\n    jruby -S rake war:standalone:run\r\n\r\n=== Deployment ===\r\nThis command will build a war file you can deploy in Tomcat:\r\n\r\n  jruby -S rake war:standalone:create\r\n\r\n=== Benchmark ===\r\n\r\nhttp://blog.nicksieger.com/articles/2007/10/25/jruby-on-rails-fast-enough\r\n\r\n== Rails 2.0 ==\r\n\r\n=== Prerequisites ===\r\n* Ruby on Rails 2.0.2\r\n* [[Warbler | Warbler (minimal, flexible, ruby-like way to create .war file)]] \r\n* Java 6\r\n* Tomcat 6\r\n* JRuby 1.0.3\r\n\r\n''Note Other versions of Java, Rails 2.x, and Tomcat may work''\r\n\r\n=== Environment setup ===\r\n\r\n<pre>\r\njruby -S gem install -y rails warbler\r\n</pre>\r\n\r\n=== Development ===\r\n\r\nCreate .war\r\n<pre>\r\n$RAILS_APP_ROOT/jruby -S warble war \r\n</pre>\r\n\r\nCreate config/warble.rb \r\n<pre>\r\n$RAILS_APP_ROOT/jruby -S warble config\r\n</pre>\r\n\r\nClean .war\r\n<pre>\r\n$RAILS_APP_ROOT/jruby -S warble war:clean\r\n</pre>\r\n\r\n''Note: C Ruby works fine as well''\r\n\r\n=== Deployment ===\r\n\r\nCopy the generated file $YOUR_APP_NAME.war to $TOMCAT_HOME/webapps and it should auto deploy\r\n\r\n\r\nGo to http://localhost:8080/$YOUR_APP_NAME to verify that the app is running; check $TOMCAT_HOME/logs/catalina.out in case of problems.\r\n\r\n=== Logging ===\r\n\r\nAn easy way to see log information from Ruby is to add the following to environment.rb:\r\n\r\n<pre>\r\nconfig.logger = Logger.new(STDOUT)\r\n</pre>\r\n\r\n=== Known Issues ===\r\n[http://jira.codehaus.org/secure/IssueNavigator.jspa?reset=true&&query=rails+2.0&summary=true&description=true&body=true&pid=11295&status=1&status=3 Open JIRA Issues matching \"Rails 2.0\"]\r\n[http://jira.codehaus.org/secure/IssueNavigator.jspa?reset=true&&pid=11295&component=12785&sorter/field=priority&sorter/order=DESC Goldspike Servlet JIRA Issues]\r\n\r\n'''Rails Error: No :secret given to the #protect_from_forgery call. Set that or use a session store capable of generating its own keys (Cookie Session Store)'''\r\n\r\nGoldspike hasn't been updated to handle Rails 2.0 gracefully, so you need to let Rails take care of session storage. You do that by editing your web.xml and adding this value:\r\n <pre>\r\n   <context-param>\r\n       <param-name>jruby.session_store</param-name>\r\n       <param-value>db</param-value> <!-- This value really means let Rails take care of session store -->\r\n   </context-param> \r\n </pre>\r\n\r\nSee [http://caldersphere.rubyforge.org/warbler/ Warbler Web.xml section] for options on how to do this. A sample of how the web.xml.erb should look like after making this change is [http://pastie.caboo.se/134120 here].\r\n\r\n'''[http://jira.codehaus.org/browse/JRUBY-1879 Random Empty Response with Rails 2.0]''' (Resolved in 1.1)\r\n\r\n'''[http://jira.codehaus.org/browse/JRUBY-2314 Truncated HTTP POSTs in >= 1.1RC2 ]\r\n\r\n=== JRuby 1.1RC3 and Goldspike 1.6 ===\r\n\r\nThese are the only .jar files that are required.\r\n\r\nFile locations:\r\nhttp://repository.codehaus.org/org/jruby/jruby-complete/1.1RC3\r\nhttp://repository.codehaus.org/org/jruby/extras/goldspike/1.6/goldspike-1.6.jar\r\n\r\n=== Building JRuby & Goldspike from trunk ===\r\n\r\nIf you want to build JRuby & Goldspike from trunk & use Warbler, you currently have to jump through some hoops. The basic shell script below is one way to do it that works. It is meant as documentation rather than a $$ solution.\r\n\r\nNote, the Goldspike that comes with Warbler should not be used with 1.0.3 & will not work with trunk. You also need to download [http://backport-jsr166.sourceforge.net/index.php backport-util-concurrent] to $BACKPORT_UTIL_CONCURRENT_LOCATION & it must be included in your .war. (moved into the warbler gem lib prior to running jruby -S warble war).\r\n\r\nSee [[Warbler]] for an alternate approach to substituting jars that is simpler than changing the Warbler gem libs.\r\n\r\n<pre>\r\n#!/bin/bash\r\n\r\n# JRuby Env\r\nexport JRUBY_HOME=`pwd`/jruby\r\nexport PATH=$PATH:$JRUBY_HOME/bin\r\n\r\necho \"#### Checking out####\"\r\nsvn co http://svn.codehaus.org/jruby/trunk/jruby jruby\r\n\r\necho \"#### Building ####\"\r\ncd jruby\r\nant jar-complete\r\n\r\necho \"#### Installing required gems - Add whatever else you need ####\"\r\njruby -S gem install -y --no-ri --no-rdoc rails jruby-openssl rest-open-uri activerecord-jdbc-adapter warbler\r\n\r\necho \"### Replacing Goldspike Version with Latest (Assuming you built that already)\"\r\ncp $RAILS_INTEGRATION_HOME/target/goldspike-1.4-SNAPSHOT.jar lib/ruby/gems/1.8/gems/warbler-0.9.1/lib\r\n\r\necho \"### Adding required backport-util-concurrent jar\"\r\n# Not needed after 1.1RC1\r\ncp $BACKPORT_UTIL_CONCURRENT_LOCATION/backport-util-concurrent-Java60-3.1/backport-util-concurrent.jar  lib/ruby/gems/1.8/gems/warbler-0.9.1/lib\r\n\r\necho \"#### Replacing JRuby version in warbler gem with one just built (trunk)\"\r\ncp lib/jruby-complete.jar lib/ruby/gems/1.8/gems/warbler-0.9.1/lib\r\n\r\nif [ -f  lib/ruby/gems/1.8/gems/warbler-0.9.1/lib/jruby-complete-1.0.1.jar ]; then\r\n  echo \"Removing 1.0.1 Jruby\"\r\n  rm lib/ruby/gems/1.8/gems/warbler-0.9.1/lib/jruby-complete-1.0.1.jar\r\nfi\r\n\r\necho \"#### Creating .war ####\"\r\ncd $RAILS_APP_ROOT\r\njruby -S warble war\r\n\r\n</pre>\r\n","created_at":"2008-08-12T20:22:22Z","content_type":"application/vnd.com.kenai.page.revision+json"}